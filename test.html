<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢ x éŠæˆ²ç‹ å°æˆ°</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --field-color: #2d4a3e; /* é¡ä¼¼éŠæˆ²ç‹æ±ºé¬¥å ´åœ°ç¶  */
            --card-bg: #e0e0e0;
            --p1-color: #3b82f6;
            --p2-color: #ef4444;
            --text-color: #fff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- ä½ˆå±€ --- */
        .game-board {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .player-zone {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            position: relative;
            transition: background 0.3s;
        }

        .p2-zone { border-bottom: 2px solid #444; background: rgba(239, 68, 68, 0.05); }
        .p1-zone { background: rgba(59, 130, 246, 0.05); }

        .active-turn { background: rgba(255, 255, 255, 0.1) !important; }

        /* --- å€åŸŸ --- */
        .field-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            height: 140px;
            align-items: center;
            background-color: var(--field-color);
            border-radius: 8px;
            margin: 5px 0;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .hand-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            height: 100px;
            align-items: center;
            overflow-x: auto;
        }

        /* --- å¡ç‰‡æ¨£å¼ --- */
        .card {
            width: 90px;
            height: 130px;
            background: var(--card-bg);
            border-radius: 6px;
            border: 3px solid #888;
            color: #000;
            display: flex;
            flex-direction: column;
            font-size: 10px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .hand-row .card {
            width: 70px;
            height: 100px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255,255,255,0.3);
            z-index: 10;
        }

        .card.selected {
            border-color: #ffd700;
            box-shadow: 0 0 15px #ffd700;
            transform: scale(1.05);
        }

        .card-header {
            background: #d4af37; /* æ€ªç¸å¡é»ƒè‰² */
            padding: 2px;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid #000;
        }

        .card-img {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: #fff;
        }

        .card-stats {
            background: #f0f0f0;
            padding: 2px;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #000;
            font-weight: bold;
        }

        .card.attack-mode { transform: rotate(0deg); }
        .card.def-mode { transform: rotate(90deg); opacity: 0.8; }
        .card.attacked { filter: grayscale(1); cursor: not-allowed; }

        /* å±¬æ€§é¡è‰² */
        .type-fire { border-color: #ff4500; }
        .type-water { border-color: #1e90ff; }
        .type-grass { border-color: #32cd32; }
        .type-electric { border-color: #ffd700; }

        /* --- è³‡è¨Šé¢æ¿ --- */
        .info-panel {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            z-index: 100;
            width: 150px;
        }
        
        .lp-box { margin-bottom: 10px; font-size: 18px; font-weight: bold; }
        .p1-lp { color: var(--p1-color); }
        .p2-lp { color: var(--p2-color); }
        
        .phase-indicator {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #ffd700;
            border: 1px solid #ffd700;
            padding: 5px;
        }

        /* --- æ§åˆ¶å€ --- */
        .controls {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #444;
            color: white;
            border: 1px solid #888;
            border-radius: 5px;
        }

        button:hover { background: #666; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-end { background: #8b0000; border-color: #ff0000; }

        /* --- Log --- */
        .log-box {
            height: 100px;
            background: #000;
            border-top: 1px solid #555;
            padding: 5px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry { margin: 2px 0; border-bottom: 1px solid #333; }

        /* --- å‹åˆ©ç•«é¢ --- */
        #winner-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        #winner-text { font-size: 40px; color: #ffd700; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="info-panel">
        <div class="lp-box p2-lp">P2 LP: <span id="p2-lp">4000</span></div>
        <div class="lp-box p1-lp">P1 LP: <span id="p1-lp">4000</span></div>
        <div class="phase-indicator" id="current-phase">æŠ½ç‰Œéšæ®µ</div>
        <div style="font-size: 12px; text-align: center; margin-top:5px;">ç•¶å‰: <span id="current-player">P1</span></div>
    </div>

    <div class="controls">
        <button id="btn-battle" onclick="game.enterBattlePhase()">é€²å…¥æˆ°é¬¥</button>
        <button id="btn-end" class="btn-end" onclick="game.endTurn()">çµæŸå›åˆ</button>
    </div>

    <div class="game-board">
        <div class="player-zone p2-zone" id="p2-zone">
            <div class="hand-row" id="p2-hand"></div>
            <div class="field-row" id="p2-field"></div>
        </div>

        <div class="player-zone p1-zone" id="p1-zone">
            <div class="field-row" id="p1-field"></div>
            <div class="hand-row" id="p1-hand"></div>
        </div>
    </div>

    <div class="log-box" id="game-log">
        <div class="log-entry">éŠæˆ²é–‹å§‹ï¼è«‹ P1 æŠ½ç‰Œã€‚</div>
    </div>

    <div id="winner-overlay">
        <div id="winner-text">P1 ç²å‹!</div>
        <button onclick="location.reload()">é‡æ–°é–‹å§‹</button>
    </div>

    <script>
        // --- è³‡æ–™åº«: å¯¶å¯å¤¢å¡ç‰‡ ---
        const CARD_DB = [
            { id: 1, name: "å°ç«é¾", type: "fire", atk: 1200, def: 800, img: "ğŸ”¥" },
            { id: 2, name: "å‚‘å°¼é¾œ", type: "water", atk: 1000, def: 1500, img: "ğŸ’§" },
            { id: 3, name: "å¦™è›™ç¨®å­", type: "grass", atk: 1100, def: 1100, img: "ğŸŒ¿" },
            { id: 4, name: "çš®å¡ä¸˜", type: "electric", atk: 1400, def: 600, img: "âš¡" },
            { id: 5, name: "å°æ‹‰é”", type: "normal", atk: 800, def: 600, img: "ğŸ€" },
            { id: 6, name: "å¡æ¯”ç¸", type: "normal", atk: 1800, def: 2000, img: "ğŸ’¤" }, // ç¨å¾®å¼·ä¸€é»
            { id: 7, name: "é¬¼æ–¯", type: "ghost", atk: 1300, def: 200, img: "ğŸ‘»" },
            { id: 8, name: "ä¼Šå¸ƒ", type: "normal", atk: 1100, def: 900, img: "ğŸ•" },
        ];

        class Card {
            constructor(data, owner) {
                this.uid = Math.random().toString(36).substr(2, 9);
                this.name = data.name;
                this.type = data.type;
                this.atk = data.atk;
                this.def = data.def;
                this.img = data.img;
                this.owner = owner; // 'p1' or 'p2'
                this.hasAttacked = false;
                this.position = 'attack'; // or 'def'
            }

            render(location) {
                const el = document.createElement('div');
                el.className = `card type-${this.type}`;
                if (this.hasAttacked) el.classList.add('attacked');
                el.innerHTML = `
                    <div class="card-header">${this.name}</div>
                    <div class="card-img">${this.img}</div>
                    <div class="card-stats">
                        <span>âš”ï¸${this.atk}</span>
                        <span>ğŸ›¡ï¸${this.def}</span>
                    </div>
                `;
                el.dataset.uid = this.uid;
                
                if (location === 'hand') {
                    el.onclick = () => game.handleHandClick(this);
                } else if (location === 'field') {
                    el.onclick = () => game.handleFieldClick(this);
                }
                return el;
            }
        }

        class Game {
            constructor() {
                this.turn = 'p1';
                this.phase = 'draw'; // draw, main, battle
                this.players = {
                    p1: { lp: 4000, hand: [], field: [], deck: [] },
                    p2: { lp: 4000, hand: [], field: [], deck: [] }
                };
                this.selectedCard = null;
                this.hasSummoned = false;
                
                this.initDeck('p1');
                this.initDeck('p2');
                
                // åˆå§‹æ‰‹ç‰Œ 3 å¼µ
                for(let i=0; i<3; i++) { this.drawCard('p1'); this.drawCard('p2'); }
                
                this.startTurn();
            }

            log(msg) {
                const box = document.getElementById('game-log');
                const div = document.createElement('div');
                div.className = 'log-entry';
                div.innerText = `[${this.turn.toUpperCase()}] ${msg}`;
                box.insertBefore(div, box.firstChild);
            }

            initDeck(player) {
                // éš¨æ©Ÿç”Ÿæˆ 20 å¼µå¡
                for(let i=0; i<20; i++) {
                    const randomCard = CARD_DB[Math.floor(Math.random() * CARD_DB.length)];
                    this.players[player].deck.push(randomCard);
                }
            }

            drawCard(player) {
                if (this.players[player].deck.length === 0) return;
                const data = this.players[player].deck.pop();
                const card = new Card(data, player);
                this.players[player].hand.push(card);
                this.updateUI();
            }

            startTurn() {
                this.phase = 'draw';
                this.hasSummoned = false;
                this.selectedCard = null;
                
                // é‡ç½®æ”»æ“Šç‹€æ…‹
                this.players[this.turn].field.forEach(c => c.hasAttacked = false);
                
                this.updateUI();
                this.log("å›åˆé–‹å§‹ï¼ŒæŠ½ç‰Œï¼");
                
                setTimeout(() => {
                    this.drawCard(this.turn);
                    this.phase = 'main';
                    this.updateUI();
                }, 1000);
            }

            handleHandClick(card) {
                if (card.owner !== this.turn) return;
                if (this.phase !== 'main') {
                    this.log("åªèƒ½åœ¨ä¸»è¦éšæ®µå¬å–šï¼");
                    return;
                }
                if (this.hasSummoned) {
                    this.log("æœ¬å›åˆå·²ç¶“å¬å–šéäº†ï¼");
                    return;
                }
                if (this.players[this.turn].field.length >= 5) {
                    this.log("å ´åœ°å·²æ»¿ï¼");
                    return;
                }

                // å¬å–šé‚è¼¯
                const p = this.players[this.turn];
                p.hand = p.hand.filter(c => c.uid !== card.uid);
                p.field.push(card);
                this.hasSummoned = true;
                this.log(`å¬å–šäº† ${card.name} (ATK:${card.atk})`);
                this.updateUI();
            }

            handleFieldClick(card) {
                // é¸æ“‡è‡ªå·±çš„æ€ªç¸é€²è¡Œæ”»æ“Š
                if (this.phase === 'battle' && card.owner === this.turn) {
                    if (card.hasAttacked) {
                        this.log("é€™éš»æ€ªç¸å·²ç¶“æ”»æ“Šéäº†ï¼");
                        return;
                    }
                    this.selectedCard = card;
                    this.log(`é¸æ“‡äº† ${card.name} æº–å‚™æ”»æ“Š...`);
                    this.updateUI();
                    return;
                }

                // é¸æ“‡å°æ‰‹çš„æ€ªç¸ä½œç‚ºæ”»æ“Šç›®æ¨™
                if (this.phase === 'battle' && card.owner !== this.turn && this.selectedCard) {
                    this.executeAttack(this.selectedCard, card);
                }
            }

            enterBattlePhase() {
                if (this.phase !== 'main') return;
                this.phase = 'battle';
                this.selectedCard = null;
                this.log("é€²å…¥æˆ°é¬¥éšæ®µï¼");
                this.updateUI();
            }

            executeAttack(attacker, target) {
                attacker.hasAttacked = true;
                this.selectedCard = null;
                
                this.log(`${attacker.name} æ”»æ“Š ${target.name}ï¼`);
                
                // ç°¡å–®çš„æ”»æ“ŠåŠ›åˆ¤å®š (æš«ä¸è€ƒæ…®å®ˆå‚™è¡¨ç¤º)
                if (attacker.atk > target.atk) {
                    const damage = attacker.atk - target.atk;
                    this.damageLP(target.owner, damage);
                    this.destroyCard(target);
                    this.log(`${target.name} è¢«ç ´å£ï¼å°æ‰‹å—åˆ° ${damage} é»å‚·å®³ã€‚`);
                } else if (attacker.atk < target.atk) {
                    const damage = target.atk - attacker.atk;
                    this.damageLP(attacker.owner, damage);
                    this.destroyCard(attacker);
                    this.log(`æ”»æ“Šå¤±æ•—ï¼${attacker.name} è¢«åæ®ºï¼Œå—åˆ° ${damage} é»å‚·å®³ã€‚`);
                } else {
                    this.destroyCard(attacker);
                    this.destroyCard(target);
                    this.log("é›™æ–¹åŒæ­¸æ–¼ç›¡ï¼");
                }
                this.updateUI();
                this.checkWinCondition();
            }

            directAttack() {
                // é»æ“Šå°æ‰‹å€åŸŸå¯è§¸ç™¼ç›´æ¥æ”»æ“Šï¼ˆç°¡å–®å¯¦ä½œï¼‰
                if (this.phase === 'battle' && this.selectedCard) {
                    const opponent = this.turn === 'p1' ? 'p2' : 'p1';
                    if (this.players[opponent].field.length === 0) {
                        const dmg = this.selectedCard.atk;
                        this.selectedCard.hasAttacked = true;
                        this.damageLP(opponent, dmg);
                        this.log(`${this.selectedCard.name} ç›´æ¥æ”»æ“Šï¼é€ æˆ ${dmg} é»å‚·å®³ï¼`);
                        this.selectedCard = null;
                        this.updateUI();
                        this.checkWinCondition();
                    } else {
                        this.log("å°æ‰‹å ´ä¸Šæœ‰æ€ªç¸ï¼Œç„¡æ³•ç›´æ¥æ”»æ“Šï¼");
                    }
                }
            }

            destroyCard(card) {
                const p = this.players[card.owner];
                p.field = p.field.filter(c => c.uid !== card.uid);
            }

            damageLP(player, amount) {
                this.players[player].lp -= amount;
                if (this.players[player].lp < 0) this.players[player].lp = 0;
            }

            checkWinCondition() {
                if (this.players.p1.lp <= 0) this.endGame('P2');
                else if (this.players.p2.lp <= 0) this.endGame('P1');
            }

            endGame(winner) {
                document.getElementById('winner-overlay').style.display = 'flex';
                document.getElementById('winner-text').innerText = `${winner} ç²å‹ï¼`;
            }

            endTurn() {
                this.turn = this.turn === 'p1' ? 'p2' : 'p1';
                this.startTurn();
            }

            updateUI() {
                // æ›´æ–°æ–‡å­—
                document.getElementById('p1-lp').innerText = this.players.p1.lp;
                document.getElementById('p2-lp').innerText = this.players.p2.lp;
                document.getElementById('current-phase').innerText = this.getPhaseName();
                document.getElementById('current-player').innerText = this.turn.toUpperCase();
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                document.getElementById('btn-battle').disabled = (this.phase !== 'main');
                
                // æ›´æ–°å€åŸŸé«˜äº®
                document.getElementById('p1-zone').className = `player-zone p1-zone ${this.turn === 'p1' ? 'active-turn' : ''}`;
                document.getElementById('p2-zone').className = `player-zone p2-zone ${this.turn === 'p2' ? 'active-turn' : ''}`;

                // æ¸²æŸ“å€åŸŸ (å‡½æ•¸å°è£)
                const renderZone = (zoneId, cards, loc) => {
                    const container = document.getElementById(zoneId);
                    container.innerHTML = '';
                    cards.forEach(card => {
                        const el = card.render(loc);
                        if (this.selectedCard && this.selectedCard.uid === card.uid) {
                            el.classList.add('selected');
                        }
                        container.appendChild(el);
                    });
                };

                renderZone('p1-hand', this.players.p1.hand, 'hand');
                renderZone('p1-field', this.players.p1.field, 'field');
                renderZone('p2-hand', this.players.p2.hand, 'hand');
                renderZone('p2-field', this.players.p2.field, 'field');
            }
            
            getPhaseName() {
                switch(this.phase) {
                    case 'draw': return 'æŠ½ç‰Œéšæ®µ';
                    case 'main': return 'ä¸»è¦éšæ®µ';
                    case 'battle': return 'æˆ°é¬¥éšæ®µ';
                    default: return '';
                }
            }
        }

        // åˆå§‹åŒ–éŠæˆ²
        const game = new Game();

        // é»æ“Šå°æ‰‹å ´åœ°å€åŸŸ (ç”¨æ–¼ç›´æ¥æ”»æ“Š)
        document.getElementById('p2-zone').onclick = (e) => {
            if (e.target.id === 'p2-zone' || e.target.classList.contains('field-row')) {
                if(game.turn === 'p1') game.directAttack();
            }
        };
        document.getElementById('p1-zone').onclick = (e) => {
             if (e.target.id === 'p1-zone' || e.target.classList.contains('field-row')) {
                if(game.turn === 'p2') game.directAttack();
            }
        };

    </script>
</body>
</html>
