<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¶²é ç‰ˆå¤§æˆ°ç•¥ Prototype</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #2c3e50; color: white; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 10px; }
        #game-container { display: flex; gap: 20px; margin-top: 20px; }
        canvas { background-color: #7f8c8d; box-shadow: 0 0 20px rgba(0,0,0,0.5); cursor: crosshair; }
        #ui-panel { width: 250px; background: #34495e; padding: 15px; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; }
        .btn { padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-blue { background-color: #3498db; color: white; }
        .btn-blue:hover { background-color: #2980b9; }
        .btn-red { background-color: #e74c3c; color: white; }
        .btn-green { background-color: #27ae60; color: white; }
        .unit-card { background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; }
        .unit-card:hover { background: rgba(255,255,255,0.1); }
        .unit-card.active { border-color: #f1c40f; background: rgba(241, 196, 15, 0.1); }
        h2, h3 { margin: 0 0 10px 0; border-bottom: 1px solid #7f8c8d; padding-bottom: 5px; }
        #log { height: 150px; overflow-y: auto; font-size: 12px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 4px; }
        
        /* Hero Modal */
        #hero-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .hero-selection { background: #2c3e50; padding: 30px; border-radius: 10px; text-align: center; }
        .hero-option { display: inline-block; margin: 10px; padding: 20px; background: #34495e; cursor: pointer; border: 2px solid #7f8c8d; border-radius: 8px; width: 120px; }
        .hero-option:hover { border-color: #f1c40f; transform: translateY(-2px); }
    </style>
</head>
<body>

    <div id="hero-modal">
        <div class="hero-selection">
            <h1>é¸æ“‡ä½ çš„æŒ‡æ®å®˜</h1>
            <div class="hero-option" onclick="startGame('berserker')">
                <div style="font-size: 40px;">ğŸª“</div>
                <h3>ç‹‚æˆ°å£«</h3>
                <p>æ¥µé«˜è¿‘æˆ°å‚·å®³</p>
            </div>
            <div class="hero-option" onclick="startGame('mage')">
                <div style="font-size: 40px;">ğŸ”®</div>
                <h3>å¤§æ³•å¸«</h3>
                <p>é ç¨‹ç¯„åœé­”æ³•</p>
            </div>
        </div>
    </div>

    <h1>âš”ï¸ ç¶²é ç‰ˆå¤§æˆ°ç•¥</h1>
    
    <div id="game-container">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        
        <div id="ui-panel">
            <div id="turn-info">
                <h3>å›åˆ: <span id="turn-count">1</span> - <span id="current-player" style="color:#3498db">è—æ–¹ (ç©å®¶)</span></h3>
                <p>é‡‘éŒ¢: <span id="gold-display" style="color:#f1c40f">0</span> G</p>
                <p>æ”¶å…¥: +<span id="income-display">0</span>/å›åˆ</p>
            </div>

            <button class="btn btn-red" onclick="endTurn()">çµæŸå›åˆ</button>

            <h3>ç”Ÿç”¢å–®ä½</h3>
            <div id="production-list">
                </div>

            <h3>æˆ°é¬¥æ—¥èªŒ</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        // --- è¨­å®šèˆ‡å¸¸æ•¸ ---
        const TILE_SIZE = 40;
        const COLS = 15;
        const ROWS = 15;
        const CANVAS = document.getElementById('gameCanvas');
        const CTX = CANVAS.getContext('2d');
        
        // åœ°å½¢ä»£ç¢¼: 0:å¹³åŸ, 1:å±±è„ˆ(ä¸å¯è¡Œ), 2:æ°´åŸŸ(ä¸å¯è¡Œ), 3:åŸå¸‚(å¯ä½”é ˜), 4: è—æ–¹åŸºåœ°, 5: ç´…æ–¹åŸºåœ°
        const TERRAIN_COLORS = ['#27ae60', '#7f8c8d', '#2980b9', '#f39c12', '#2c3e50', '#c0392b'];
        
        // å–®ä½å®šç¾©
        const UNIT_TYPES = {
            warrior: { name: "æˆ°å£«", symbol: "âš”ï¸", cost: 100, hp: 100, atk: 25, range: 1, move: 3, type: 'infantry' },
            spear:   { name: "é•·æ§å…µ", symbol: "ğŸ›¡ï¸", cost: 150, hp: 100, atk: 20, range: 1, move: 3, type: 'spear' },
            archer:  { name: "å¼“å…µ", symbol: "ğŸ¹", cost: 200, hp: 80,  atk: 20, range: 2, move: 3, type: 'archer' },
            cavalry: { name: "é¨å…µ", symbol: "ğŸ", cost: 300, hp: 120, atk: 35, range: 3, move: 5, type: 'cavalry', minRange: 2 }, // ç‰¹æ®Šï¼šç›´ç·šæ”»æ“Š
            monk:    { name: "åƒ§ä¾¶", symbol: "âš•ï¸", cost: 250, hp: 60,  atk: 0,  range: 1, move: 3, type: 'healer', heal: 30 }
        };

        const HERO_TYPES = {
            berserker: { name: "ç‹‚æˆ°å£«è‹±é›„", symbol: "ğŸ‘¹", hp: 200, atk: 50, range: 1, move: 4, type: 'infantry' },
            mage:      { name: "å¤§æ³•å¸«è‹±é›„", symbol: "ğŸ§™", hp: 100, atk: 45, range: 3, move: 3, type: 'mage' }
        };

        // --- éŠæˆ²ç‹€æ…‹ ---
        let gameState = {
            turn: 1,
            player: 'blue', // blue or red
            gold: 500,
            units: [],
            map: [], // å­˜å„²åœ°å½¢
            cities: [], // å­˜å„²åŸå¸‚æ“æœ‰æ¬Š {x, y, owner: null/'blue'/'red'}
            selectedUnit: null,
            selectedBuildType: null,
            gameOver: false
        };

        // --- åˆå§‹åŒ–åœ°åœ– ---
        function initMap() {
            // ç°¡å–®ç”Ÿæˆåœ°åœ–
            for(let y=0; y<ROWS; y++) {
                let row = [];
                for(let x=0; x<COLS; x++) {
                    let t = 0; // å¹³åŸ
                    if(Math.random() < 0.15) t = 1; // å±±
                    if(Math.random() < 0.1) t = 2; // æ°´
                    if(Math.random() < 0.05 && x > 2 && x < COLS-2) {
                        t = 3; // åŸå¸‚
                        gameState.cities.push({x, y, owner: null});
                    }
                    row.push(t);
                }
                gameState.map.push(row);
            }
            // è¨­å®šåŸºåœ°
            gameState.map[ROWS-1][1] = 4; // è—æ–¹åŸºåœ°
            gameState.map[1][COLS-2] = 5; // ç´…æ–¹åŸºåœ°
            // æ¸…é™¤åŸºåœ°å‘¨åœéšœç¤™
            gameState.map[ROWS-2][1] = 0; gameState.map[ROWS-1][2] = 0;
            gameState.map[1][COLS-3] = 0; gameState.map[2][COLS-2] = 0;
        }

        // --- é–‹å§‹éŠæˆ² ---
        function startGame(heroType) {
            document.getElementById('hero-modal').style.display = 'none';
            initMap();
            
            // ç”Ÿæˆè—æ–¹è‹±é›„
            spawnUnit(heroType, 1, ROWS-1, 'blue', true);
            // ç”Ÿæˆç´…æ–¹(AI)è‹±é›„ (éš¨æ©Ÿ)
            let aiHero = Math.random() > 0.5 ? 'berserker' : 'mage';
            spawnUnit(aiHero, COLS-2, 1, 'red', true);

            renderProductionMenu();
            draw();
            updateUI();
        }

        function spawnUnit(type, x, y, owner, isHero = false) {
            let stats = isHero ? HERO_TYPES[type] : UNIT_TYPES[type];
            gameState.units.push({
                ...stats,
                id: Math.random().toString(36),
                x: x,
                y: y,
                owner: owner,
                maxHp: stats.hp,
                hasMoved: false,
                hasActed: false,
                isHero: isHero
            });
            log(`${owner === 'blue' ? 'è—æ–¹' : 'ç´…æ–¹'} ç”Ÿç”¢äº† ${stats.name}`);
        }

        // --- æ¸²æŸ“é‚è¼¯ ---
        function draw() {
            CTX.clearRect(0, 0, CANVAS.width, CANVAS.height);

            // 1. ç•«åœ°åœ–
            for(let y=0; y<ROWS; y++) {
                for(let x=0; x<COLS; x++) {
                    let terrain = gameState.map[y][x];
                    CTX.fillStyle = TERRAIN_COLORS[terrain];
                    
                    // åŸå¸‚é¡è‰²æ ¹æ“šæ“æœ‰è€…æ”¹è®Š
                    if (terrain === 3) {
                        let city = gameState.cities.find(c => c.x === x && c.y === y);
                        if(city.owner === 'blue') CTX.fillStyle = '#3498db'; // è—åŸ
                        if(city.owner === 'red') CTX.fillStyle = '#e74c3c';  // ç´…åŸ
                    }

                    CTX.fillRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    CTX.strokeStyle = 'rgba(0,0,0,0.2)';
                    CTX.strokeRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    
                    // æ¨™è¨˜åŸºåœ°
                    if(terrain === 4) drawText('ğŸ ', x, y); // Blue Base
                    if(terrain === 5) drawText('ğŸ°', x, y); // Red Base
                    if(terrain === 3) drawText('ğŸ›–', x, y); // City
                    if(terrain === 1) drawText('â›°ï¸', x, y);
                    if(terrain === 2) drawText('ğŸŒŠ', x, y);
                }
            }

            // 2. ç•«ç§»å‹•ç¯„åœæç¤º
            if (gameState.selectedUnit && !gameState.selectedUnit.hasMoved && gameState.selectedUnit.owner === 'blue') {
                showMoveRange(gameState.selectedUnit);
            }
            
            // 3. ç•«æ”»æ“Šç¯„åœæç¤º (å¦‚æœå·²ç§»å‹•ä½†æœªè¡Œå‹•)
            if (gameState.selectedUnit && gameState.selectedUnit.hasMoved && !gameState.selectedUnit.hasActed) {
                showAttackRange(gameState.selectedUnit);
            }

            // 4. ç•«å–®ä½
            gameState.units.forEach(u => {
                // å¤–æ¡†è¡¨ç¤ºé™£ç‡Ÿ
                CTX.fillStyle = u.owner === 'blue' ? 'rgba(52, 152, 219, 0.7)' : 'rgba(231, 76, 60, 0.7)';
                if(u === gameState.selectedUnit) CTX.fillStyle = '#f1c40f'; // é¸ä¸­é«˜äº®
                if(u.hasActed) CTX.fillStyle = '#95a5a6'; // å·²è¡Œå‹•è®Šç°
                
                CTX.fillRect(u.x*TILE_SIZE + 2, u.y*TILE_SIZE + 2, TILE_SIZE-4, TILE_SIZE-4);
                drawText(u.symbol, u.x, u.y);
                
                // è¡€æ¢
                let hpPct = u.hp / u.maxHp;
                CTX.fillStyle = 'red';
                CTX.fillRect(u.x*TILE_SIZE+5, u.y*TILE_SIZE+32, 30, 4);
                CTX.fillStyle = '#2ecc71';
                CTX.fillRect(u.x*TILE_SIZE+5, u.y*TILE_SIZE+32, 30*hpPct, 4);
            });
        }

        function drawText(text, x, y) {
            CTX.fillStyle = 'white';
            CTX.font = '20px Arial';
            CTX.textAlign = 'center';
            CTX.textBaseline = 'middle';
            CTX.fillText(text, x*TILE_SIZE + TILE_SIZE/2, y*TILE_SIZE + TILE_SIZE/2);
        }

        function showMoveRange(unit) {
            // ç°¡åŒ–ç‰ˆï¼šæ›¼å“ˆé “è·é›¢ï¼Œä¸è€ƒæ…®è¤‡é›œå°‹è·¯ï¼Œåªé¿é–‹å±±å’Œæ°´
            for(let y=0; y<ROWS; y++) {
                for(let x=0; x<COLS; x++) {
                    if(Math.abs(x - unit.x) + Math.abs(y - unit.y) <= unit.move) {
                        if(gameState.map[y][x] !== 1 && gameState.map[y][x] !== 2) {
                            CTX.fillStyle = 'rgba(255, 255, 255, 0.3)';
                            CTX.fillRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
                        }
                    }
                }
            }
        }

        function showAttackRange(unit) {
            CTX.fillStyle = 'rgba(231, 76, 60, 0.3)'; // Red overlay
            
            for(let y=0; y<ROWS; y++) {
                for(let x=0; x<COLS; x++) {
                    if (isValidAttackTarget(unit, x, y)) {
                        CTX.fillRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    }
                }
            }
        }

        // --- æ ¸å¿ƒé‚è¼¯ ---

        // æª¢æŸ¥æ˜¯å¦ç‚ºåˆæ³•çš„æ”»æ“Šä½ç½®
        function isValidAttackTarget(unit, tx, ty) {
            let dx = Math.abs(tx - unit.x);
            let dy = Math.abs(ty - unit.y);
            let dist = dx + dy; // æ›¼å“ˆé “è·é›¢

            // é¨å…µç‰¹æ®Šé‚è¼¯ï¼šç›´ç·š 2-3 æ ¼
            if (unit.type === 'cavalry') {
                if ((dx === 0 || dy === 0) && (dist >= 2 && dist <= 3)) return true;
                return false;
            }

            // ä¸€èˆ¬å–®ä½
            if (dist <= unit.range) return true;
            return false;
        }

        // é»æ“Šè™•ç†
        CANVAS.addEventListener('mousedown', (e) => {
            if(gameState.gameOver || gameState.player !== 'blue') return;

            const rect = CANVAS.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / TILE_SIZE);
            const y = Math.floor((e.clientY - rect.top) / TILE_SIZE);

            // 1. æ”¾ç½®æ–°å–®ä½ (å¦‚æœåœ¨åŸºåœ°é™„è¿‘)
            if (gameState.selectedBuildType) {
                // åªèƒ½åœ¨åŸºåœ°å‘¨åœä¸€åœˆç”Ÿç”¢
                let baseX = 1, baseY = ROWS-1;
                if (Math.abs(x - baseX) + Math.abs(y - baseY) <= 1 && !getUnitAt(x, y) && gameState.map[y][x] !== 1 && gameState.map[y][x] !== 2) {
                    if (gameState.gold >= UNIT_TYPES[gameState.selectedBuildType].cost) {
                        gameState.gold -= UNIT_TYPES[gameState.selectedBuildType].cost;
                        spawnUnit(gameState.selectedBuildType, x, y, 'blue');
                        gameState.selectedBuildType = null;
                        renderProductionMenu(); // æ›´æ–°é¸å–®é¡¯ç¤º
                        updateUI();
                        draw();
                    } else {
                        log("é‡‘éŒ¢ä¸è¶³ï¼");
                    }
                }
                return;
            }

            let clickedUnit = getUnitAt(x, y);

            // 2. é¸æ“‡å–®ä½
            if (clickedUnit && clickedUnit.owner === 'blue' && !clickedUnit.hasActed) {
                gameState.selectedUnit = clickedUnit;
                draw();
                return;
            }

            // 3. å–®ä½è¡Œå‹•
            if (gameState.selectedUnit) {
                let u = gameState.selectedUnit;

                // ç§»å‹•éšæ®µ
                if (!u.hasMoved) {
                    // ç°¡å–®æª¢æŸ¥è·é›¢ (çœŸå¯¦éŠæˆ²éœ€è¦ A* å°‹è·¯)
                    let dist = Math.abs(x - u.x) + Math.abs(y - u.y);
                    let terrain = gameState.map[y][x];
                    let targetUnit = getUnitAt(x, y);
                    
                    // è‹¥é»æ“Šç©ºåœ°ä¸”åœ¨ç¯„åœå…§
                    if (dist <= u.move && terrain !== 1 && terrain !== 2 && !targetUnit) {
                        u.x = x;
                        u.y = y;
                        u.hasMoved = true;
                        
                        // æª¢æŸ¥æ˜¯å¦ä½”é ˜åŸå¸‚
                        if (terrain === 3) {
                            let city = gameState.cities.find(c => c.x === x && c.y === y);
                            if (city.owner !== 'blue') {
                                city.owner = 'blue';
                                log("è—æ–¹ä½”é ˜äº†ä¸€åº§åŸå¸‚ï¼");
                            }
                        }
                        draw();
                        return;
                    }
                }

                // æ”»æ“Š/å›å¾©éšæ®µ
                if (u.hasMoved && !u.hasActed) {
                    let target = getUnitAt(x, y);
                    
                    if (target) {
                        // åƒ§ä¾¶è£œè¡€
                        if (u.type === 'healer' && target.owner === 'blue' && isValidAttackTarget(u, x, y)) {
                            target.hp = Math.min(target.maxHp, target.hp + u.heal);
                            log(`${u.name} æ²»ç™‚äº† ${target.name}`);
                            u.hasActed = true;
                            gameState.selectedUnit = null;
                            draw();
                            return;
                        }

                        // æ”»æ“Šæ•µäºº
                        if (u.type !== 'healer' && target.owner === 'red' && isValidAttackTarget(u, x, y)) {
                            combat(u, target);
                            u.hasActed = true;
                            gameState.selectedUnit = null;
                            draw();
                            return;
                        }
                    } else if (x === u.x && y === u.y) {
                        // é»æ“Šè‡ªå·±å¾…å‘½
                        u.hasActed = true;
                        gameState.selectedUnit = null;
                        draw();
                    }
                }
            }
        });

        function getUnitAt(x, y) {
            return gameState.units.find(u => u.x === x && u.y === y);
        }

        function combat(attacker, defender) {
            let dmg = attacker.atk;
            let multiplier = 1.0;

            // ç›¸å‰‹é‚è¼¯
            if (attacker.type === 'spear' && defender.type === 'cavalry') multiplier = 1.5;
            if (attacker.type === 'cavalry' && (defender.type === 'infantry' || defender.type === 'archer')) multiplier = 1.5;
            if (attacker.type === 'archer' && defender.type === 'spear') multiplier = 1.5;
            if (attacker.type === 'mage' && defender.type === 'infantry') multiplier = 1.2;

            let finalDmg = Math.floor(dmg * multiplier);
            defender.hp -= finalDmg;
            
            log(`${attacker.name} æ”»æ“Š ${defender.name} (x${multiplier}) é€ æˆ ${finalDmg} å‚·å®³`);

            if (defender.hp <= 0) {
                log(`${defender.name} è¢«æ“Šæ•—äº†ï¼`);
                gameState.units = gameState.units.filter(u => u !== defender);
                // å‹åˆ©æ¢ä»¶
                if(defender.isHero && defender.owner === 'red') {
                    alert("å‹åˆ©ï¼ç´…æ–¹æŒ‡æ®å®˜è¢«æ“Šæ•—ï¼");
                    gameState.gameOver = true;
                }
            }
        }

        // --- éŠæˆ²æµç¨‹æ§åˆ¶ ---
        function endTurn() {
            if(gameState.gameOver) return;

            // 1. çµç®—è—æ–¹
            gameState.units.forEach(u => {
                if(u.owner === 'blue') { u.hasMoved = false; u.hasActed = false; }
            });
            gameState.selectedUnit = null;
            gameState.selectedBuildType = null;
            
            // è¨ˆç®—æ”¶å…¥
            let income = 100; // åŸºç¤æ”¶å…¥
            gameState.cities.forEach(c => { if(c.owner === 'blue') income += 50; });
            gameState.gold += income;
            
            gameState.player = 'red';
            updateUI();
            log("--- ç´…æ–¹å›åˆ ---");

            // 2. ç´…æ–¹ AI (ç°¡å–®ç‰ˆ)
            setTimeout(aiTurn, 500);
        }

        function aiTurn() {
            let aiUnits = gameState.units.filter(u => u.owner === 'red');
            let playerUnits = gameState.units.filter(u => u.owner === 'blue');
            let baseTarget = {x: 1, y: ROWS-1}; // AI ç›®æ¨™ï¼šè—æ–¹åŸºåœ°

            // ç°¡å–®AIé‚è¼¯
            aiUnits.forEach(unit => {
                // å°‹æ‰¾æœ€è¿‘ç›®æ¨™
                let target = playerUnits[0];
                let minDist = 999;
                
                playerUnits.forEach(p => {
                    let d = Math.abs(p.x - unit.x) + Math.abs(p.y - unit.y);
                    if (d < minDist) { minDist = d; target = p; }
                });

                if (!target) return; // è´äº†

                // å˜—è©¦ç§»å‹• (å‘ç›®æ¨™é è¿‘)
                let dx = target.x - unit.x;
                let dy = target.y - unit.y;
                
                let stepX = unit.x + Math.sign(dx);
                let stepY = unit.y + Math.sign(dy);
                
                // ç¬¨æ‹™çš„ç§»å‹•æª¢æŸ¥ (AIåªèµ°ä¸€æ ¼ï¼Œé˜²æ­¢ç©¿ç‰†bug)
                if (!getUnitAt(stepX, unit.y) && gameState.map[unit.y][stepX] !== 1 && gameState.map[unit.y][stepX] !== 2) {
                    unit.x = stepX;
                } else if (!getUnitAt(unit.x, stepY) && gameState.map[stepY][unit.x] !== 1 && gameState.map[stepY][unit.x] !== 2) {
                    unit.y = stepY;
                }

                // å˜—è©¦æ”»æ“Š
                playerUnits.forEach(p => {
                    if (isValidAttackTarget(unit, p.x, p.y)) {
                         combat(unit, p);
                    }
                });
                
                // AI ä½”é ˜åŸå¸‚
                let city = gameState.cities.find(c => c.x === unit.x && c.y === unit.y);
                if(city && city.owner !== 'red') city.owner = 'red';
            });

            // AI ç”Ÿç”¢å–®ä½ (å¦‚æœåŸºåœ°æ²’äºº)
            let redBaseX = COLS-2, redBaseY = 1;
            if (!getUnitAt(redBaseX, redBaseY) && Math.random() > 0.3) {
                let types = Object.keys(UNIT_TYPES);
                let randomType = types[Math.floor(Math.random() * types.length)];
                spawnUnit(randomType, redBaseX, redBaseY, 'red');
            }

            gameState.turn++;
            gameState.player = 'blue';
            gameState.units.forEach(u => {
                if(u.owner === 'red') { u.hasMoved = false; u.hasActed = false; }
            });
            
            log("--- è—æ–¹å›åˆ ---");
            updateUI();
            draw();
        }

        // --- UI äº’å‹• ---
        function renderProductionMenu() {
            const list = document.getElementById('production-list');
            list.innerHTML = '';
            for (let key in UNIT_TYPES) {
                let u = UNIT_TYPES[key];
                let div = document.createElement('div');
                div.className = 'unit-card';
                div.innerHTML = `<span>${u.symbol} ${u.name}</span> <span>$${u.cost}</span>`;
                div.onclick = () => {
                    // å–æ¶ˆé¸ä¸­
                    document.querySelectorAll('.unit-card').forEach(el => el.classList.remove('active'));
                    if (gameState.selectedBuildType === key) {
                        gameState.selectedBuildType = null;
                    } else {
                        gameState.selectedBuildType = key;
                        div.classList.add('active');
                        log("è«‹é»æ“ŠåŸºåœ°é™„è¿‘ (è—è‰²å€åŸŸ) æ”¾ç½®å–®ä½");
                    }
                };
                list.appendChild(div);
            }
        }

        function updateUI() {
            document.getElementById('turn-count').innerText = gameState.turn;
            document.getElementById('gold-display').innerText = gameState.gold;
            
            let income = 100;
            gameState.cities.forEach(c => { if(c.owner === 'blue') income += 50; });
            document.getElementById('income-display').innerText = income;
            
            let pText = document.getElementById('current-player');
            if(gameState.player === 'blue') {
                pText.innerText = "è—æ–¹ (ç©å®¶)";
                pText.style.color = "#3498db";
            } else {
                pText.innerText = "ç´…æ–¹ (AIæ€è€ƒä¸­...)";
                pText.style.color = "#e74c3c";
            }
        }

        function log(msg) {
            let el = document.getElementById('log');
            el.innerHTML = `<div>> ${msg}</div>` + el.innerHTML;
        }

        // å•Ÿå‹•
        // initMap called in startGame
    </script>
</body>
</html>
