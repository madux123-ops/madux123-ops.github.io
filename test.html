<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鬼滅之刃：像素獵鬼譚</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --ui-bg: #2d2d44;
            --pixel-border: 4px solid #000;
            --text-color: #fff;
            --accent-color: #e94560;
            --tanjiro: #2cb67d;
            --nezuko: #ff8fab;
            --zenitsu: #ffd93d;
            --rengoku: #ff6b6b;
        }

        body {
            background-color: #0f0f1a;
            color: var(--text-color);
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            user-select: none;
            overflow: hidden;
        }

        /* 遊戲手機容器 */
        #game-container {
            width: 375px;
            height: 667px;
            background: var(--bg-color);
            border: 8px solid #444;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
        }

        /* 頂部資源欄 */
        .header {
            height: 60px;
            background: var(--ui-bg);
            border-bottom: 4px solid #000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 10px;
            z-index: 10;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .icon {
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .coin-icon { background: #ffd700; border: 2px solid #b8860b; }
        .gem-icon { background: #da70d6; border: 2px solid #8b008b; }

        /* 中間戰場 */
        .stage-area {
            flex: 1;
            position: relative;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            overflow: hidden;
        }

        /* 背景流動動畫 */
        .scrolling-bg {
            position: absolute;
            bottom: 0;
            width: 200%;
            height: 100px;
            background-image: 
                linear-gradient(90deg, transparent 50%, rgba(255,255,255,0.1) 50%),
                linear-gradient(90deg, #16213e 0%, #16213e 100%);
            background-size: 50px 100%;
            animation: scrollGround 2s linear infinite;
        }

        @keyframes scrollGround {
            from { transform: translateX(0); }
            to { transform: translateX(-50px); }
        }

        /* 角色容器 */
        .battle-field {
            position: absolute;
            bottom: 40px;
            width: 100%;
            height: 100px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
        }

        /* 像素小人基礎樣式 */
        .pixel-char {
            width: 32px;
            height: 32px;
            position: relative;
            image-rendering: pixelated;
        }

        /* 英雄樣式 (用CSS畫格子) */
        .hero {
            animation: bounce 0.5s infinite alternate;
        }
        .hero::after { content: ''; position: absolute; bottom: -5px; left: 5px; width: 20px; height: 4px; background: rgba(0,0,0,0.3); border-radius: 50%; }

        /* 炭治郎 (綠黑格紋) */
        #tanjiro { background: repeating-linear-gradient(45deg, #000 0, #000 5px, var(--tanjiro) 5px, var(--tanjiro) 10px); border: 2px solid #000; }
        /* 禰豆子 (粉色) */
        #nezuko { background: var(--nezuko); border: 2px solid #000; }
        /* 善逸 (黃色) */
        #zenitsu { background: var(--zenitsu); border: 2px solid #000; }

        /* 敵人樣式 */
        .enemy {
            width: 40px;
            height: 40px;
            background: #555;
            border: 2px solid #800080;
            position: absolute;
            right: 10%;
            bottom: 0;
            transition: opacity 0.2s;
        }
        .enemy.boss {
            width: 60px;
            height: 60px;
            background: #800000;
            border: 3px solid #ff0000;
        }

        /* 攻擊動畫 */
        @keyframes attackDash {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        .attacking { animation: attackDash 0.2s ease-out !important; }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        /* 傷害數字 */
        .damage-text {
            position: absolute;
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 2px 2px #000;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
        }
        
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(1.5); }
        }

        /* 呼吸法特效 */
        .effect-water {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 4px solid #00bfff;
            border-radius: 50%;
            opacity: 0;
            top: -10px; left: 10px;
        }

        /* 底部導航 */
        .footer {
            height: 70px;
            background: var(--ui-bg);
            border-top: 4px solid #000;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 8px;
            color: #888;
            cursor: pointer;
        }
        .nav-btn.active { color: #fff; }
        .nav-icon {
            width: 30px;
            height: 30px;
            background: #444;
            border: 2px solid #000;
            box-shadow: inset -2px -2px 0 rgba(0,0,0,0.5);
        }
        .nav-btn.active .nav-icon { background: var(--accent-color); }

        /* BOSS 按鈕 */
        #boss-btn {
            position: absolute;
            bottom: 80px;
            right: 10px;
            background: linear-gradient(to bottom, #ff4d4d, #990000);
            border: 2px solid #fff;
            padding: 10px;
            font-size: 10px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 0 #550000;
            border-radius: 5px;
            text-align: center;
            z-index: 20;
            animation: pulse 1.5s infinite;
        }
        #boss-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #550000; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* 技能條 */
        .hp-bar-container {
            width: 32px;
            height: 4px;
            background: #333;
            position: absolute;
            top: -10px;
        }
        .hp-bar { height: 100%; background: #00ff00; width: 100%; }
        .enemy-hp-container {
            width: 100%;
            height: 6px;
            background: #000;
            position: absolute;
            top: -15px;
            border: 1px solid #fff;
        }
        .enemy-hp { height: 100%; background: #ff0000; width: 100%; transition: width 0.1s; }

    </style>
</head>
<body>

<div id="game-container">
    <div class="header">
        <div class="resource">⚔️ <span id="power-display">12,450</span></div>
        <div class="resource"><div class="icon coin-icon"></div> <span id="coin-display">0</span></div>
        <div class="resource"><div class="icon gem-icon"></div> <span id="gem-display">100</span></div>
    </div>

    <div class="stage-area">
        <div style="position: absolute; top: 20px; width: 100%; text-align: center; color: rgba(255,255,255,0.3); font-size: 20px;">
            無限列車篇
        </div>
        <div style="position: absolute; top: 50px; width: 100%; text-align: center; color: rgba(255,255,255,0.5); font-size: 10px;">
            WAVE <span id="wave-num">1</span>
        </div>

        <div class="scrolling-bg"></div>

        <div class="battle-field">
            <div style="display: flex; gap: 10px; align-items: flex-end;">
                <div id="tanjiro" class="pixel-char hero">
                    <div class="hp-bar-container"><div class="hp-bar"></div></div>
                </div>
                <div id="nezuko" class="pixel-char hero"></div>
                <div id="zenitsu" class="pixel-char hero"></div>
            </div>

            <div id="enemy" class="pixel-char enemy">
                <div class="enemy-hp-container"><div id="enemy-hp-bar" class="enemy-hp"></div></div>
            </div>
        </div>

        <div id="boss-btn">
            挑戰<br>BOSS
        </div>
    </div>

    <div class="footer">
        <div class="nav-btn">
            <div class="nav-icon" style="background: #555;"></div>
            隊伍
        </div>
        <div class="nav-btn">
            <div class="nav-icon" style="background: #4a69bd;"></div>
            鍛刀
        </div>
        <div class="nav-btn active">
            <div class="nav-icon"></div>
            戰鬥
        </div>
        <div class="nav-btn">
            <div class="nav-icon" style="background: #d980fa;"></div>
            召喚
        </div>
        <div class="nav-btn">
            <div class="nav-icon" style="background: #f6b93b;"></div>
            商店
        </div>
    </div>
</div>

<script>
    // 遊戲數據
    const gameState = {
        coins: 0,
        wave: 1,
        enemyHp: 100,
        maxEnemyHp: 100,
        isBoss: false,
        heroes: [
            { id: 'tanjiro', name: '炭治郎', damage: 15, color: '#88ccff' },
            { id: 'nezuko', name: '禰豆子', damage: 12, color: '#ffaaaa' },
            { id: 'zenitsu', name: '善逸', damage: 25, color: '#ffffaa' }
        ]
    };

    const enemyEl = document.getElementById('enemy');
    const enemyHpBar = document.getElementById('enemy-hp-bar');
    const coinDisplay = document.getElementById('coin-display');
    const waveDisplay = document.getElementById('wave-num');
    const stageArea = document.querySelector('.stage-area');

    // 遊戲主循環：英雄自動攻擊
    gameState.heroes.forEach((hero, index) => {
        // 每個英雄攻擊速度略有不同
        const speed = 1000 + (index * 400); 
        
        setInterval(() => {
            if (document.hidden) return; // 簡單的優化

            const heroEl = document.getElementById(hero.id);
            
            // 播放攻擊動畫
            heroEl.classList.add('attacking');
            setTimeout(() => heroEl.classList.remove('attacking'), 200);

            // 計算是否有爆擊 (善逸爆擊率高)
            let dmg = hero.damage;
            let isCrit = false;
            if (hero.id === 'zenitsu' && Math.random() > 0.7) {
                dmg *= 2;
                isCrit = true;
            }

            // 對敵人造成傷害
            takeDamage(dmg);

            // 顯示傷害數字
            showDamageNumber(dmg, isCrit, hero.color);

        }, speed);
    });

    function takeDamage(amount) {
        gameState.enemyHp -= amount;
        
        // 更新血條
        const pct = Math.max(0, (gameState.enemyHp / gameState.maxEnemyHp) * 100);
        enemyHpBar.style.width = pct + '%';

        // 敵人受擊閃爍
        enemyEl.style.opacity = '0.5';
        setTimeout(() => enemyEl.style.opacity = '1', 100);

        // 敵人死亡判定
        if (gameState.enemyHp <= 0) {
            enemyDie();
        }
    }

    function enemyDie() {
        // 隱藏敵人
        enemyEl.style.display = 'none';
        
        // 給予獎勵
        const reward = gameState.isBoss ? 500 : 50;
        gameState.coins += reward;
        updateUI();

        // 升級波數
        gameState.wave++;
        
        // 重置敵人
        setTimeout(() => {
            gameState.isBoss = false; // 重置回小怪 (簡單邏輯)
            enemyEl.classList.remove('boss');
            
            // 血量隨波數成長
            gameState.maxEnemyHp = 100 + (gameState.wave * 20);
            gameState.enemyHp = gameState.maxEnemyHp;
            
            enemyEl.style.display = 'block';
            enemyHpBar.style.width = '100%';
            updateUI();
        }, 500); // 0.5秒後重生
    }

    // 傷害跳字特效
    function showDamageNumber(amount, isCrit, color) {
        const div = document.createElement('div');
        div.className = 'damage-text';
        div.innerText = isCrit ? `CRIT ${amount}!` : amount;
        div.style.color = color;
        
        // 隨機位置
        const randomX = 220 + Math.random() * 50;
        const randomY = 400 + Math.random() * 50;
        
        div.style.left = randomX + 'px';
        div.style.top = randomY + 'px';

        if (isCrit) {
            div.style.fontSize = '16px';
            div.style.zIndex = 100;
        }

        stageArea.appendChild(div);

        // 動畫結束後移除元素
        setTimeout(() => {
            div.remove();
        }, 800);
    }

    function updateUI() {
        coinDisplay.innerText = gameState.coins.toLocaleString();
        waveDisplay.innerText = gameState.wave;
    }

    // BOSS 按鈕互動
    document.getElementById('boss-btn').addEventListener('click', () => {
        if(gameState.isBoss) return;
        
        alert("⚠️ 警告：下弦之壹 夢魘 來襲！");
        gameState.isBoss = true;
        gameState.maxEnemyHp *= 5; // BOSS 血量加倍
        gameState.enemyHp = gameState.maxEnemyHp;
        
        enemyEl.classList.add('boss');
        enemyHpBar.style.width = '100%';
    });

</script>

</body>
</html>
